#!/bin/sh

# This is a wrapper script that allows the model validator to be used as a
# postprocessor on StarExec.

# $1: cleaned up model
# $2: benchmark after preprocessing

./dolmen --check-model=true $2 < $1 &> error.txt
EXITSTATUS=$?

if [ "$EXITSTATUS" = "0" ]; then
    echo "starexec-result=sat"
    echo "model_validator_status=VALID"
elif [ "$EXITSTATUS" = "5" ]; then
    echo "starexec-result=unsat"
    echo "model_validator_status=INVALID"
else
    echo "starexec-result=unknown"
    echo "model_validator_status=UNKNOWN"
fi
echo "dolmenexit=$EXITSTATUS"
if [ -s "error.txt" ]; then
    echo "model_validation_error="`grep '^[WEF]:' error.txt`
fi
exit 0
